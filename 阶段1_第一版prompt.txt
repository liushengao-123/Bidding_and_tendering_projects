输出存在问题：
“源数据文档”：{
            "采购内容": "货物。 咸阳分公司2023-2024年度职工餐厅食材采购项目，主要包括主材类（大米、面粉、机制面条、糯米、食用油等）、副食类（肉、蛋、奶、冷冻鸡鸭鱼肉、鲜活畜禽等） 和其他类（蔬菜、水果、调味品、辅食类等）食材。合同期：12个月。"
        }
模型得到的回答:        
{"key": "servicePeriod", "value": null}
模型应该得到回答：
{"key": "servicePeriod", "value": 12个月}

我在Key对应关系表中强调过从采购内容中抽取服务周期或合同期的value值：
"servicePeriod": "采购内容中抽取服务周期或合同期"。
但是，最后没有提取成功。
请给我调整提示词，解决此需求。

SHANGHAI_SYSTEM_PROMPT : |
   你是一个高度智能的、专门用于从结构化文档中抽取信息的AI助手。
    你的任务流程如下：
    1.  你将收到一个 **“Key对应关系表”** (从英语key映射到中文key)。
    2.  你还将收到一份 **“源数据文档”** (一个复杂的、可能包含多层嵌套列表和字典的JSON结构)。
    3.  对于 **“Key对应关系表”** 中的每一个英语key，请执行以下操作：
        a. 找到它对应的中文key（例如，`procurementContent` -> `采购内容`）。
        b. 在整个 **“源数据文档”** 中，**深入递归地搜索**这个中文key。
        c. 找到后，提取与该中文key完整关联的value。

    请严格遵守以下规则：
    1.  **深度搜索**：源数据文档是嵌套的。你必须遍历所有层级，包括列表中的字典，来查找匹配的中文key。
    2.  **精确提取**：一旦找到中文key，就提取其对应的完整值，不要自行修改或缩减。
    3.  **格式要求**：最终返回一个JSON对象数组，格式与用户提供的“输出样例”完全一致。键（key）必须是原始的英语key。
    4.  **缺失处理**：如果在整个源数据文档中都找不到某个中文key，其对应的值应为 null 或 "未找到"。
    5.  **保持纯净**：不要在最终的JSON结果之外添加任何解释、思考过程或问候语。




SHANGHAI_USER_PROMPT = f"""
请根据你在系统指令中被设定的角色和规则，处理以下信息并返回JSON结果。

### 1. Key对应关系表 (English Key -> Chinese Key)
---
{LLM_KEY_VALUE_MAP}

### 2. 源数据文档 (Source Document to search in)
---
{KEY_VALUE}

### 3. 输出样例 (Output Example)
---
{EXAMPLE}

请开始抽取。
"""


EXAMPLE : |
  [
  {"key":"procurementContent","value":货物。榆林分公司公司员工餐厅食材采购，主要包括米面粮油及副食品类（米、面、油、调味品、干货、辅食类等）、生鲜肉蛋及果蔬类（蔬菜、水果、肉、蛋、奶等） 食材。"},
  {"key":"projectBudget","value":"本项目预算金额277.75万元(不含税)。"},
  {"key":"servicePeriod","value":"自合同签订之日起一年。"},
  {"key":"sectionDivision","value":"本项目不划分标包。"},
  {"key":"contractSigningMode","value":"本项目签订框架合同，合同金额按预算金额签订。"},
  {"key":"Bidder","value":"应答人须为在中华人民共和国境内依法注册的法人或其他组织。"},
  {"key":"Tax_Requirements","value":"应答人能够开具增值税专用发票(须提供相关证明材料)。"},
  {"key":"Qualification","value":"应答人需具备：须具备有效的食品经营许可证。"},
  ] 




Key对应关系表:
{
  "procurementContent": "采购内容",
  "servicePeriod": "采购内容中抽取服务周期或合同期",
  "projectBudget": "预算金额",
  "sectionDivision": "标段/标包划分或标包、标段划分",
  "InquiryType": "标段/标包划分或标包、标段划分",
  "contractSigningMode": "合同签约模式",
  "inquiryForm": "组织形式",
  "Max_projectBudget": "最高限价",
  "Bid_Security_Amount": "采购及履约过程风险控制中抽取应答保证金或投标保证金",
  "Evaluators_Number": "评审委员会组成、评标委员会组成",
  "Selected_Principles": "中选人确定原则",
  "Performance_Bond": "履约保证金",
  "Special_Circumstances": "公开招标、公开比选",
  "Post-Evaluation_weight": "评审办法",
  "Delivery_Period": "交货期",
  "Delivery_Location": "交货地点"
  }



源数据文档:
{
    "关于咸阳分公司2023-2024年度职工餐\n厅食材采购项目采购方案的汇报": [],
    "特定关系人与特定事项申报通知": [],
    "项目概况": [
        {
            "采购依据": "咸阳分公司2023-2024年度职工餐厅食材采购项目，经省公司2023年第43次总经理办公会会议审议，同意立项。根据咸阳分公司采购申请单，供应链管理部拟启动该项目的采购工作。"
        },
        {
            "资金来源": "本项目属于成本类开支。"
        },
        {
            "预算金额": "本项目预算金额355.16万元（不含税）。"
        },
        {
            "采购内容": "货物。 咸阳分公司2023-2024年度职工餐厅食材采购项目，主要包括主材类（大米、面粉、机制面条、糯米、食用油等）、副食类（肉、蛋、奶、冷冻鸡鸭鱼肉、鲜活畜禽等） 和其他类（蔬菜、水果、调味品、辅食类等）食材。合同期：12个月。"
        },
        {
            "采购信息表报送": "本项目不属于基础通信网络单元的重要网络产品和服务范围，不涉及关键基础信息表报送。"
        },
        {
            "网络安全审查": "根据公司网络安全审查机制要求，本项目不涉及网络安全审查预判工作。"
        }
    ],
    "采购方案": [
        {
            "采购方式及理由": "公开比选。本项目不属于法定招标范围，为加强竞争性，拟采用公开比选方式进行采购。"
        },
        {
            "资格审查方式": "本项目采用资格后审。"
        },
        {
            "组织形式": "本项目委托河北良诚招标代理有限公司代理组织采购。"
        },
        {
            "操作方式": "本项目采用无纸化电子采购。"
        },
        {
            "标段 /标包划分": "本项目不划分标包，划分为2个份额，具体如下："
        },
        {
            "最高限价": "本项目设置最高限价，应答综合折扣限价为100%。"
        },
        {
            "中选人确定原则": "按照综合得分由高至低的顺序排序，推荐综合得分排名前2名为中选候选人，确定综合得分排名前2名为中选人，中选份额依次为60%、40%。经评审的综合得分相等时，以评审价低者优先的原则推荐中选候选人；若评审价仍出现相等，以类似项目业绩累计金额高者优先的原则推荐中选候选人。"
        },
        {
            "合同签约模式": "本项目签订框架合同，合同金额按预算金额签订。"
        },
        {
            "业绩是否公示": "本项目公示业绩。"
        }
    ],
    "采购方案-潜在供应商资格条件": [
        {
            "应答人自2020年07月01日至应答截止之日止须至少具备一个单个合同金额不低于50万元的类似项目业绩。核算业绩数量以合同数量为准；应答人须提供合同关键页扫描件等证明材料，原件备查": "①合同关键页包括不限于合同封面、合同服务内容（合同标的）、合同金额、合同大签页等； ②业绩金额认定：合同以相对应的采购订单（或结算单）累计金额为准，若无订单（或结算单）则以合同对应的发票累计金额为准； ③凡提供合同及相对应的采购订单（或结算单）扫描件，须同时提供至少一张相对应的发票扫描件及发票真实有效的证明材料扫描件；凡提供合同及相对应的发票扫描件，须同时提供相对应的全部发票真实有效的证明材料扫描件。 ④发票真实有效的证明材料（国家税务总局全国增值税发票查验平台发票查询截图或发票开具单位当地税务机关出具的发票开具证明或其他可以证明发票真实有效的证明材料等）； ⑤订单（或结算单）须由甲方签字或盖章，否则视为无效订单（或结算单）； ⑥业绩日期认定：以合同签订日期为准。"
        },
        {
            "应答人不得存在以下情况": "1) 被责令停业的；2) 财产被接管或冻结，影响正常经营的；3) 在全国企业信用信息公示系统中被列入严重违法失信企业名单；4) 法定代表人或负责人 被“信用中国”网站列入失信被执行人名单（已执行完毕或不再执行的除外）；5) 在“信用中国”和工信部网站被相关行政监督部门暂停或取消应答/中选资格的（不受地域限制）；6) 在“信用中国”和工信部网站最近三年内（至本项目应答截止日期前36个月内）有被相关行政监督部门判定并发布弄虚作假骗取中标或严重违约或重大安全及事故责任、质量问题的。"
        },
        {
            "应答人之间存在下列互为关联关系的情形之一的，不得同时参加本项目的应答": "单位负责人为同一人或者存在控股、管理关系等可能影响公平性的不同单位，不得同时参加同一标包应答或者未划分标包的同一项目应答。"
        }
    ],
    "采购方案-合同主要条款": [],
    "采购方案-评审方法": [
        {
            "评审办法": "本项目采用综合评估法，价格60%，技术40%，价格技术各100分。综合评审得分=价格得分*60%+技术得分*40%，具体评审办法为：价格详见附录价格，技术详见附录技术。"
        }
    ],
    "采购方案-特殊情况处理": [
        {
            "公开比选": "当购买比选文件、递交应答文件或通过初步评审的供应商数量（S）<N+2（N为中选人数量，下同）时，则按照如下方式进行处理： 1、S=3，若评审委员会认定项目仍具备竞争性，继续实施后续比选过程； 2、S＜3，重新启动新的比选程序。 3、若重新启动后， 购买比选文件、递交应答文件或通过初步评审的供应商数量（S）仍<N+2， 若评审委员会认定项目仍具备竞争性，按下表方式处理："
        }
    ],
    "采购方案-其他": [
        {
            "评审委员会组成": "成员人数7人。从中国移动专家库内随机抽取5人，采购人代表2人。"
        },
        {
            "采购及履约过程风险控制": "1、应答保证金：为保证公司合法权益，向应答人收取应答保证金20000元；通过ES系统管理保证金。 2、履约保证金：人民币中选金额2%。"
        }
    ],
    "项目实施进度表 – 实施进度计划": [],
    "采购主要风险点评估（一）": [],
    "采购主要风险点评估（二）": [],
    "决策点": [],
    "附件-应答一览表": [],
    "附件-分项报价表": [],
    "附录-智慧平台核查结果": []
}






模型返回：

    当然，这个问题非常典型，它暴露了您当前Prompt的一个核心矛盾：您要求模型执行两种完全不同的操作，却没有给它清晰的指令来区分何时执行哪一种。
当前的矛盾点在于：
指令A (主要任务)：在源数据文档中精确查找Key对应关系表里的中文key，并原样提取其对应的value。
指令B (隐藏任务)：对于"servicePeriod"，不要执行指令A。而是要去"采购内容"的value里二次抽取信息。
模型严格遵守了更普适、更主要的指令A，所以在源数据文档里找不到一个独立的 "服务周期或合同期" 字段，于是返回了null。
要解决这个问题，我们需要升级Prompt，赋予模型更强的逻辑判断和复合任务处理能力。
优化后的 SHANGHAI_SYSTEM_PROMPT
这是解决问题的关键。我们需要将“简单查找”升级为“智能查找与二次抽取”。
code
Yaml
SHANGHAI_SYSTEM_PROMPT: |
  你是一个高度智能的、专门用于从结构化文档中抽取信息的AI助手。

  你的任务是根据一个“Key对应关系表”从一份“源数据文档”中提取信息。这个过程分为两种模式：

  **模式1：直接映射 (Direct Mapping)**
  -   当“Key对应关系表”中的中文值为一个**简单的名词**时（如 "采购内容", "预算金额"），这是你的默认操作。
  -   **流程**:
      a. 在整个“源数据文档”中，深入递归地搜索这个名词作为key。
      b. 找到后，提取其对应的完整value。

  **模式2：二次抽取 (Secondary Extraction)**
  -   当“Key对应关系表”中的中文值为一个**包含“抽取”字样的指令性描述**时（如 "采购内容中抽取服务周期或合同期"），你需要启用此模式。
  -   **流程**:
      a. **解析指令**: 理解指令的含义。例如，“采购内容中抽取服务周期或合同期”意味着你需要先找到“采购内容”的文本。
      b. **定位源文本**: 使用指令中的名词（如“采购内容”）作为key，执行一次“直接映射”查找，获取到基础文本。
      c. **执行抽取**: 在上一步获取到的基础文本中，根据指令要求（如“服务周期或合同期”），抽取出最关键、最简洁的信息（如 "12个月"）。

  **最终规则**:
  1.  **智能判断**: 对于关系表中的每一个key，首先判断应采用“直接映射”还是“二次抽取”模式。
  2.  **深度搜索**: 在“直接映射”和“二次抽取”的定位源文本阶段，都必须遍历所有层级来查找key。
  3.  **精确提取**: 在“二次抽取”模式下，只返回最核心的信息，而不是包含它的整个句子。
  4.  **格式要求**: 最终返回一个JSON对象数组，格式与用户提供的“输出样例”完全一致。键（key）必须是原始的英语key。
  5.  **缺失处理**: 如果在任何模式下都无法找到所需信息，其对应的值应为 null。
  6.  **保持纯净**: 不要在最终的JSON结果之外添加任何解释或思考过程。
为什么这样修改？
引入“模式”概念：
明确告诉模型，它的工作不是单一的，而是有两种模式：直接映射 (Direct Mapping) 和 二次抽取 (Secondary Extraction)。这给了模型处理复杂情况的“工具箱”。
提供清晰的触发条件：
模型现在知道如何区分这两种模式：看到简单的名词就用模式1，看到包含“抽取”的指令就用模式2。这个规则简单、明确，可操作性强。
分解复杂任务：
对于“二次抽取”，我们将其流程分解为三步：解析指令 -> 定位源文本 -> 执行抽取。这就像是给模型写了一份清晰的“代码注释”，指导它如何一步步完成这个更复杂的任务。
强调提取质量：
规则3中特别强调，在“二次抽取”模式下，要返回最核心的信息（"12个月"），而不是整个句子（"合同期：12个月。"）。这能显著提升输出结果的质量和可用性。
整合到最终规则：
将“智能判断”作为第一条最终规则，强制模型在处理每个key之前都先进行思考和决策。
USER_PROMPT 的调整
您的 USER_PROMPT 无需做任何修改。它已经非常清晰地提供了所有必需的材料（关系表、源文档、样例）。问题出在模型的“说明书”（System Prompt）不够详细，而不是给它的“原材料”有问题。
总结
通过这次升级，您将模型的角色从一个只会“按键寻值”的简单数据库，提升为了一个能理解指令、判断情况、并执行多步操作的智能分析师。
现在，当模型处理到 "servicePeriod" 时，它会：
看到关系表中的值是 "采购内容中抽取服务周期或合同期"。
识别出这包含“抽取”字样，触发模式2：二次抽取。
解析指令：明白要去“采购内容”里找“服务周期或合同期”。
定位源文本：在源文档中找到"采购内容"，获取其value："货物。...合同期：12个月。"。
执行抽取：在这段文本中找到"合同期：12个月"，并提取出核心信息"12个月"。
最终生成正确的输出：{"key": "servicePeriod", "value": "12个月"}。
这样就完美地解决了您的需求。






第二版优化：
有一个新需求：
公开招标或公开比选、采购及履约过程风险控制中抽取应答保证金或投标保证金，需要做选择抽取，请优化提示词

SHANGHAI_SYSTEM_PROMPT: |
  你是一个高度智能的、专门用于从结构化文档中抽取信息的AI助手。

  你的任务是根据一个“Key对应关系表”从一份“源数据文档”中提取信息。这个过程分为两种模式：

  **模式1：直接映射 (Direct Mapping)**
  -   (1)当“Key对应关系表”中的中文值为一个**简单的名词**时（如 "采购内容", "预算金额"），这是你的默认操作。
  -   **流程**:
      a. 在整个“源数据文档”中，深入递归地搜索这个名词作为key。
      b. 找到后，提取其对应的完整value。
  -   (2)当“Key对应关系表”中的中文值包含**或**时（如 "评审委员会组成或评标委员会组成", "标段 /标包划分或标包、标段划分"），要在原文中做匹配。
  -   **流程**:
      a. 在整个“源数据文档”中，深入递归地搜索或之前和或之后名词作为key。
      b. 找到后，提取其对应的完整value。
  **模式2：二次抽取 (Secondary Extraction)**
  -   当“Key对应关系表”中的中文值为一个**包含“抽取”等字样的指令性描述**时（如 "采购内容中抽取服务周期或合同期"），你需要启用此模式。
  -   **流程**:
      a. **解析指令**: 理解指令的含义。例如，“采购内容中抽取服务周期或合同期”意味着你需要先找到“采购内容”的文本。
      b. **定位源文本**: 使用指令中的名词（如“采购内容”）作为key，执行一次“直接映射”查找，获取到基础文本。
      c. **执行抽取**: 在上一步获取到的基础文本中，根据指令要求（如“服务周期或合同期”），抽取出最关键、最简洁的信息（如 "12个月"）。

  **最终规则**:
  1.  **智能判断**: 对于关系表中的每一个key，首先判断应采用“直接映射”还是“二次抽取”模式。
  2.  **深度搜索**: 在“直接映射”和“二次抽取”的定位源文本阶段，都必须遍历所有层级来查找key。
  3.  **精确提取**: 在“二次抽取”模式下，只返回最核心的信息，而不是包含它的整个句子。
  4.  **格式要求**: 最终返回一个JSON对象数组，格式与用户提供的“输出样例”完全一致。键（key）必须是原始的英语key。
  5.  **缺失处理**: 如果在任何模式下都无法找到所需信息，其对应的值应为 null。
  6.  **保持纯净**: 不要在最终的JSON结果之外添加任何解释或思考过程。




回答：
好的，这个新需求非常棒，它将模型的任务从“两种模式”提升到了需要处理“多种模式的组合”，这对Prompt的逻辑清晰度和健壮性提出了更高的要求。
您在模式1中尝试加入(2)来处理“或”的逻辑，思路是正确的，但这会让模式定义变得有些混乱。我们可以通过升级和泛化模式的定义，让整个指令集更具一致性和扩展性，从而优雅地解决这个新需求。
核心思想是：
升级“直接映射”：让它原生就能处理“同义词/备选词”（即用“或”连接的情况）。
升级“二次抽取”：让它不仅能抽取，还能在抽取的过程中处理“备选目标”。
优化后的 SHANGHAI_SYSTEM_PROMPT
这个版本重构了两种模式的定义，使其更加强大和通用。
code
Yaml
SHANGHAI_SYSTEM_PROMPT: |
  你是一个高度智能的、专门用于从结构化文档中抽取信息的AI助手。

  你的任务是根据一个“Key对应关系表”从“源数据文档”中提取信息。请根据关系表中中文值的不同，采用以下两种操作模式之一：

  **模式1：直接映射 (Direct Mapping)**
  -   **触发条件**: 当关系表中的中文值为一个或多个用“或”、“/”连接的**实体名词**时（如 "预算金额", "公开招标或公开比选"）。
  -   **核心逻辑**: 寻找一个与所提供名词匹配的**键 (key)**。
  -   **执行流程**:
      a. **解析查找目标**: 识别出所有需要查找的名词。如果只有一个名词，目标就是它本身；如果由“或”连接，那么列表中的每一个都是备选目标。
      b. **深度搜索**: 在整个“源数据文档”中，**依次尝试**搜索每个备选目标作为键。
      c. **提取价值**: 一旦找到**第一个匹配的键**，立即提取其对应的完整value，并停止对该英语key的后续搜索。

  **模式2：定向抽取 (Targeted Extraction)**
  -   **触发条件**: 当关系表中的中文值为一个包含**“中抽取”、“中查找”等指令性描述**的句子时（如 "采购内容中抽取服务周期", "风险控制中抽取保证金"）。
  -   **核心逻辑**: 在一个已存在的**值 (value)** 中，搜索并抽取出一段**子文本 (sub-text)**。
  -   **执行流程**:
      a. **解析指令**: 明确指令的两个部分：**源文本定位词**（“中”前面的部分）和**抽取目标词**（“抽取”后面的部分）。
      b. **定位源文本**: 使用“源文本定位词”作为key，执行一次**模式1**的查找，获取到用于分析的基础长文本。
      c. **执行抽取**: 在上一步获取的基础文本中，根据“抽取目标词”进行搜索。
         - 如果“抽取目标词”包含“或”（如“应答保证金或投标保证金”），则**依次尝试**在文本中寻找每一个备选目标。
         - 找到**第一个匹配的内容**后，提取出最核心、最简洁的信息（例如，仅提取金额“20000元”，而不是整个句子）。

  **最终规则**:
  1.  **模式优先**: 对于关系表中的每一个key，首先判断应采用“直接映射”还是“定向抽取”模式。
  2.  **深度搜索**: 在所有查找键（key）的步骤中，都必须遍历文档的所有层级。
  3.  **精确简洁**: 在“定向抽取”模式下，返回的结果必须是最核心的信息，避免冗余。
  4.  **格式统一**: 最终返回一个JSON对象数组，格式与用户提供的“输出样例”完全一致。键（key）必须是原始的英语key。
  5.  **缺失处理**: 如果在任何模式下都无法找到所需信息，其对应的值应为 null。
  6.  **保持纯净**: 不要在最终的JSON结果之外添加任何解释或思考过程。
为什么这次的修改更优越？
逻辑更清晰：
我们将两种操作的核心逻辑提炼了出来：模式1是找键 (find a key)，模式2是在值里找文本 (find text within a value)。这个根本区别让模型更容易理解任务的本质。
我将二次抽取改名为定向抽取 (Targeted Extraction)，听起来更专业，也更符合“在指定靶标内抽取”的含义。
处理“或”的逻辑被优雅地整合了：
在模式1中，公开招标或公开比选 被自然地解释为“依次尝试搜索这两个备选目标键”。
在模式2中，应答保证金或投标保证金 被自然地解释为“在源文本中依次尝试寻找这两个备选子文本”。
“或”不再是一个特殊的规则，而是两种模式都能理解的**“备选列表”**，这使得指令集非常统一和强大。
覆盖了您的新需求：
对于 公开招标或公开比选：模型会启用模式1，先在文档里找 "公开招标" 这个key，如果找不到，再去找 "公开比选" 这个key。
对于 采购及履约过程风险控制中抽取应答保证金或投标保证金：模型会启用模式2。
a. 解析指令: 源文本定位词是采购及履约过程风险控制，抽取目标词是应答保证金或投标保证金。
b. 定位源文本: 在文档中找到"采购及履约过程风险控制"的value。
c. 执行抽取: 在这个value里，先找应答保证金相关内容，如果没找到，再找投标保证金相关内容，提取出核心信息。
前瞻性和扩展性：
这套新的指令框架非常健壮。未来如果您有更复杂的抽取需求，比如“在A或B中抽取C”，或者“在A中抽取B或C或D”，这套逻辑都能轻松应对，您只需要在关系表中写明即可，而无需再次修改System Prompt。
您的USER_PROMPT和EXAMPLE依然无需修改，只需要用这个新的、更强大的SHANGHAI_SYSTEM_PROMPT替换掉旧的即可。


第三版优化
出现一个新需求，模型输出结果如下：
{"key": "Special_Circumstances", "value": null},
模型输出分析如下：
在Special_Circumstances，我设为null。
确认Special_Circumstances：关系表说"公开招标或公开比选"，在源文档中，"采购方式及理由"的value是"公开比选"，但key是"采购方式及理由"，不是"公开比选"。所以，没有key等于"公开招标"或"公开比选"，因此null。
在输出样例中，有"key":"procurementContent", "value":...，所以我们的输出应该是一个JSON数组。

但是他的输出不符合我想要的答案：
{"key": "Special_Circumstances", "value": "比选项目或某标段供应商不足3家时，按照以下方式处理： 一、购买采购文件、递交应答文件的供应商不足3家时： 1、 比选项目购买采购文件的供应商、递交应答文件供应商仅有1家时，应重新启动比选程序，并书面告知该供应商后续重新启动的相关事宜。若重新启动后供应商数量仍不足的，采购人可继续实施后续比选程序或与应答供应商进行谈判。 2、比选项目购买采购文件的供应商、递交应答文件供应商为2家时，可继续实施后续比选程序或与应答供应商进行谈判。 二、比选项目因在评审过程中否决投标导致供应商数量不足3家时，若评审委员会认定项目仍具备竞争性，可继续实施后续采购过程；若评审委员会认定项目已不具备竞争性，应重新组织采购。"}

出现这个问题的原因，是因为“源数据文档”的特殊性，第一层嵌套的key是总标题，比如"采购方案-合同主要条款"、"采购方案-评标方法"，"公开招标或公开比选"是在"采购方案-特殊情况处理"下面，但是大模型分析完"采购方式及理由"之后，就没有进行继续查找，返回了null。
请优化prompt,解决此需求。






SHANGHAI_SYSTEM_PROMPT: |
  你是一个高度智能的、专门用于从结构化文档中抽取信息的AI助手。

  你的任务是根据一个“Key对应关系表”从“源数据文档”中提取信息。请根据关系表中中文值的不同，采用以下两种操作模式之一：

  **模式1：直接映射 (Direct Mapping)**
  -   **触发条件**: 当关系表中的中文值为一个或多个用“或”、“/”连接的**实体名词**时（如 "预算金额", "公开招标或公开比选"）。
  -   **核心逻辑**: 寻找一个与所提供名词匹配的**键 (key)**。
  -   **执行流程**:
      a. **解析查找目标**: 识别出所有需要查找的名词。如果只有一个名词，目标就是它本身；如果由“或”连接，那么列表中的每一个都是备选目标。
      b. **深度搜索**: 在整个“源数据文档”中，**依次尝试**搜索每个备选目标作为键。
      c. **提取价值**: 一旦找到**第一个匹配的键**，立即提取其对应的完整value，并停止对该英语key的后续搜索。

  **模式2：定向抽取 (Targeted Extraction)**
  -   **触发条件**: 当关系表中的中文值为一个包含**“中抽取”、“中查找”等指令性描述**的句子时（如 "采购内容中抽取服务周期", "风险控制中抽取保证金"）。
  -   **核心逻辑**: 在一个已存在的**值 (value)** 中，搜索并抽取出一段**子文本 (sub-text)**。
  -   **执行流程**:
      a. **解析指令**: 明确指令的两个部分：**源文本定位词**（“中”前面的部分）和**抽取目标词**（“抽取”后面的部分）。
      b. **定位源文本**: 使用“源文本定位词”作为key，执行一次**模式1**的查找，获取到用于分析的基础长文本。
      c. **执行抽取**: 在上一步获取的基础文本中，根据“抽取目标词”进行搜索。
         - 如果“抽取目标词”包含“或”（如“应答保证金或投标保证金”），则**依次尝试**在文本中寻找每一个备选目标。
         - 找到**第一个匹配的内容**后，提取出最核心、最简洁的信息（例如，仅提取金额“20000元”，而不是整个句子）。

  **最终规则**:
  1.  **模式优先**: 对于关系表中的每一个key，首先判断应采用“直接映射”还是“定向抽取”模式。
  2.  **深度搜索**: 在所有查找键（key）的步骤中，都必须遍历文档的所有层级。
  3.  **精确简洁**: 在“定向抽取”模式下，返回的结果必须是最核心的信息，避免冗余。
  4.  **格式统一**: 最终返回一个JSON对象数组，格式与用户提供的“输出样例”完全一致。键（key）必须是原始的英语key。
  5.  **缺失处理**: 如果在任何模式下都无法找到所需信息，其对应的值应为 null。
  6.  **保持纯净**: 不要在最终的JSON结果之外添加任何解释或思考过程。




  LLM_KEY-VALUE_MAP : |
  {
  "procurementContent": "采购内容",
  "servicePeriod": "采购内容中抽取服务周期或合同期",
  "projectBudget": "预算金额",
  "sectionDivision": "标段 /标包划分或标包、标段划分",
  "InquiryType": "标段 /标包划分或标包、标段划分",
  "contractSigningMode": "合同签约模式",
  "inquiryForm": "组织形式",
  "Max_projectBudget": "最高限价",
  "Bid_Security_Amount": "采购及履约过程风险控制中抽取应答保证金或投标保证金",
  "Evaluators_Number": "评审委员会组成或评标委员会组成",
  "Selected_Principles": "中选人确定原则",
  "Performance_Bond": "采购及履约过程风险控制中抽取履约保证金",
  "Special_Circumstances": "公开招标或公开比选",
  "Post-Evaluation_weight": "评审办法",
  "Delivery_Period": "交货期",
  "Delivery_Location": "交货地点"
  }


源数据文档:
{
    "关于咸阳分公司2023-2024年度职工餐\n厅食材采购项目采购方案的汇报": [],
    "特定关系人与特定事项申报通知": [],
    "项目概况": [
        {
            "采购依据": "咸阳分公司2023-2024年度职工餐厅食材采购项目，经省公司2023年第43次总经理办公会会议审议，同意立项。根据咸阳分公司采购申请单，供应链管理部拟启动该项目的采购工作。"
        },
        {
            "资金来源": "本项目属于成本类开支。"
        },
        {
            "预算金额": "本项目预算金额355.16万元（不含税）。"
        },
        {
            "采购内容": "货物。 咸阳分公司2023-2024年度职工餐厅食材采购项目，主要包括主材类（大米、面粉、机制面条、糯米、食用油等）、副食类（肉、蛋、奶、冷冻鸡鸭鱼肉、鲜活畜禽等） 和其他类（蔬菜、水果、调味品、辅食类等）食材。合同期：12个月。"
        },
        {
            "采购信息表报送": "本项目不属于基础通信网络单元的重要网络产品和服务范围，不涉及关键基础信息表报送。"
        },
        {
            "网络安全审查": "根据公司网络安全审查机制要求，本项目不涉及网络安全审查预判工作。"
        }
    ],
    "采购方案": [
        {
            "采购方式及理由": "公开比选。本项目不属于法定招标范围，为加强竞争性，拟采用公开比选方式进行采购。"
        },
        {
            "资格审查方式": "本项目采用资格后审。"
        },
        {
            "组织形式": "本项目委托河北良诚招标代理有限公司代理组织采购。"
        },
        {
            "操作方式": "本项目采用无纸化电子采购。"
        },
        {
            "标段 /标包划分": "本项目不划分标包，划分为2个份额，具体如下："
        },
        {
            "最高限价": "本项目设置最高限价，应答综合折扣限价为100%。"
        },
        {
            "中选人确定原则": "按照综合得分由高至低的顺序排序，推荐综合得分排名前2名为中选候选人，确定综合得分排名前2名为中选人，中选份额依次为60%、40%。经评审的综合得分相等时，以评审价低者优先的原则推荐中选候选人；若评审价仍出现相等，以类似项目业绩累计金额高者优先的原则推荐中选候选人。"
        },
        {
            "合同签约模式": "本项目签订框架合同，合同金额按预算金额签订。"
        },
        {
            "业绩是否公示": "本项目公示业绩。"
        }
    ],
    "采购方案-潜在供应商资格条件": [
        {
            "应答人自2020年07月01日至应答截止之日止须至少具备一个单个合同金额不低于50万元的类似项目业绩。核算业绩数量以合同数量为准；应答人须提供合同关键页扫描件等证明材料，原件备查": "①合同关键页包括不限于合同封面、合同服务内容（合同标的）、合同金额、合同大签页等； ②业绩金额认定：合同以相对应的采购订单（或结算单）累计金额为准，若无订单（或结算单）则以合同对应的发票累计金额为准； ③凡提供合同及相对应的采购订单（或结算单）扫描件，须同时提供至少一张相对应的发票扫描件及发票真实有效的证明材料扫描件；凡提供合同及相对应的发票扫描件，须同时提供相对应的全部发票真实有效的证明材料扫描件。 ④发票真实有效的证明材料（国家税务总局全国增值税发票查验平台发票查询截图或发票开具单位当地税务机关出具的发票开具证明或其他可以证明发票真实有效的证明材料等）； ⑤订单（或结算单）须由甲方签字或盖章，否则视为无效订单（或结算单）； ⑥业绩日期认定：以合同签订日期为准。"
        },
        {
            "应答人不得存在以下情况": "1) 被责令停业的；2) 财产被接管或冻结，影响正常经营的；3) 在全国企业信用信息公示系统中被列入严重违法失信企业名单；4) 法定代表人或负责人 被“信用中国”网站列入失信被执行人名单（已执行完毕或不再执行的除外）；5) 在“信用中国”和工信部网站被相关行政监督部门暂停或取消应答/中选资格的（不受地域限制）；6) 在“信用中国”和工信部网站最近三年内（至本项目应答截止日期前36个月内）有被相关行政监督部门判定并发布弄虚作假骗取中标或严重违约或重大安全及事故责任、质量问题的。"
        },
        {
            "应答人之间存在下列互为关联关系的情形之一的，不得同时参加本项目的应答": "单位负责人为同一人或者存在控股、管理关系等可能影响公平性的不同单位，不得同时参加同一标包应答或者未划分标包的同一项目应答。"
        }
    ],
    "采购方案-合同主要条款": [],
    "采购方案-评审方法": [
        {
            "评审办法": "本项目采用综合评估法，价格60%，技术40%，价格技术各100分。综合评审得分=价格得分*60%+技术得分*40%，具体评审办法为：价格详见附录价格，技术详见附录技术。"
        }
    ],
    "采购方案-特殊情况处理": [
        {
            "公开比选": "当购买比选文件、递交应答文件或通过初步评审的供应商数量（S）<N+2（N为中选人数量，下同）时，则按照如下方式进行处理： 1、S=3，若评审委员会认定项目仍具备竞争性，继续实施后续比选过程； 2、S＜3，重新启动新的比选程序。 3、若重新启动后， 购买比选文件、递交应答文件或通过初步评审的供应商数量（S）仍<N+2， 若评审委员会认定项目仍具备竞争性，按下表方式处理："
        }
    ],
    "采购方案-其他": [
        {
            "评审委员会组成": "成员人数7人。从中国移动专家库内随机抽取5人，采购人代表2人。"
        },
        {
            "采购及履约过程风险控制": "1、应答保证金：为保证公司合法权益，向应答人收取应答保证金20000元；通过ES系统管理保证金。 2、履约保证金：人民币中选金额2%。"
        }
    ],
    "项目实施进度表 – 实施进度计划": [],
    "采购主要风险点评估（一）": [],
    "采购主要风险点评估（二）": [],
    "决策点": [],
    "附件-应答一览表": [],
    "附件-分项报价表": [],
    "附录-智慧平台核查结果": []
}


模型返回：
好的，您这次遇到的问题非常精准地揭示了当前Prompt的一个核心缺陷，也是一个非常微妙的逻辑漏洞。
问题的根源：
您让模型去寻找一个名为"公开招标"或"公开比选"的 键 (key)。
而在您的源数据文档中，确实存在一个键 "公开比选"，它位于"采购方案-特殊情况处理"这个大标题之下。
为什么模型没有找到？
模型在分析时，犯了一个“逻辑捷径”错误。它看到了"采购方式及理由"的值 (value) 里包含了"公开比选"这个词，于是它就错误地认为已经处理过了"公开比选"这个目标，并且因为这个词没有出现在key的位置，所以判定查找失败。它没有继续完整地、耐心地遍历整个JSON文档的其他部分。
这是典型的**“局部最优陷阱”**。模型找到了一个看似相关的线索，就停止了更全面的搜索。
要解决这个问题，我们需要引入一个新的概念，让模型能够区分 “作为值的提及” 和 “作为键的存在”，并赋予它在一种失败后尝试另一种策略的能力。
优化后的 SHANGHAI_SYSTEM_PROMPT
这个版本引入了一个全新的模式3：情境推断 (Contextual Inference)，专门用来处理这种“键名不存在，但信息隐藏在值中”的复杂情况。
code
Yaml
SHANGHAI_SYSTEM_PROMPT: |
  你是一个高度智能、逻辑严谨的结构化文档信息抽取AI助手。

  你的任务是根据一个“Key对应关系表”从“源数据文档”中提取信息。请严格按照以下三种优先级递减的模式进行操作：

  **模式1：直接映射 (Direct Mapping) - 优先级最高**
  -   **触发条件**: 关系表中的中文值为一个或多个用“或”连接的**实体名词**（如 "预算金额"）。
  -   **核心逻辑**: 在文档中寻找一个与所提供名词完全匹配的**键 (key)**。
  -   **执行流程**:
      a. 识别出所有备选名词（如 "公开招标"、"公开比选"）。
      b. **完整地、深度地**遍历整个“源数据文档”的所有层级，搜索是否存在一个**键**与备选名词列表中的任意一个完全匹配。
      c. 如果找到，立即提取其对应的完整value，并结束对此英语key的处理。

  **模式2：定向抽取 (Targeted Extraction) - 优先级中**
  -   **触发条件**: 关系表中的中文值为包含**“中抽取”等指令性描述**的句子。
  -   **核心逻辑**: 在一个已存在的**值 (value)** 中，抽取出一段**子文本 (sub-text)**。
  -   **执行流程**: (此部分逻辑不变)
      a. 解析指令，明确“源文本定位词”和“抽取目标词”。
      b. 使用“源文本定位词”作为key，执行一次**模式1**的查找，获取基础长文本。
      c. 在基础文本中，根据“抽取目标词”（可含“或”）进行搜索，提取最核心简洁的信息。

  **模式3：情境推断 (Contextual Inference) - 优先级最低**
  -   **触发条件**: 当且仅当**模式1**完全失败（即在整个文档中都找不到匹配的**键**）时，自动启用此模式。
  -   **核心逻辑**: 寻找一个**值 (value)**，其内容与查找目标高度相关，然后提取该值所在对象的**兄弟节点信息**。
  -   **执行流程**:
      a. **重新扫描**: 再次深度遍历整个文档，这次是寻找某个**值 (value)** 的内容**包含**备选名词（如 "公开比选"）。
      b. **定位关键节点**: 找到这个值后，定位到包含它的那个JSON对象（例如，`{"采购方式及理由": "公开比选。..."}`）。
      c. **推断并提取**: 分析这个关键节点所在的上下文。模型需要推断出，与这个采购方式（公开比选）相关的“特殊情况处理”很可能就在附近。因此，它应该查找与这个节点同级的、标题中含有“特殊情况”、“处理”等字样的**兄弟节点**或**父节点的其他子节点**，并提取其内容。例如，它会找到`{"公开比选": "当购买比选文件..."}`这个对象，并提取其value。

  **最终规则**:
  1.  **严格按优先级执行**: 对于每个key，必须先尝试模式1。只有当模式1确定性失败后，才能尝试模式3。模式2是独立触发的。
  2.  **完整遍历**: **严禁**在找到一个看似相关的线索后就停止对整个文档的遍历。必须完成对所有层级的搜索，才能判定模式1失败。
  3.  **精确简洁**: 在模式2和模式3中，返回的结果应尽可能核心、简洁。
  4.  **格式统一**: 最终返回一个JSON对象数组，格式与样例一致。
  5.  **最终缺失**: 只有当所有适用模式都尝试失败后，才将值设为 null。
  6.  **保持纯净**: 不要在JSON结果之外添加任何解释。
为什么这次的修改能解决问题？
引入优先级:
明确规定了模式1 -> 模式3的降级策略。这告诉模型：“你的首要任务是找完全匹配的key。只有当你把整个文档翻遍了，确定没有这个key时，才能启动备用方案。”
定义了模式3：情境推断：
这个新模式专门应对您提出的场景。它赋予模型一种更高级的能力：当直接的路走不通时，学会“绕路”。
它不再是简单地匹配字符串，而是需要理解JSON结构中的“上下文”和“邻里关系”（兄弟节点、父节点）。
对于Special_Circumstances，模型的思考路径会变成：
a. 执行模式1：搜索键"公开招标"或"公开比选"。
b. 完整遍历：模型会扫描完整个文档，发现{"公开比选": "..."}这个键值对，于是模式1成功，直接返回值。
c. （如果a失败）执行模式3：假设"公开比选"不是键，而是像{"特殊情况处理-公开比选": "..."}这样。模式1会失败。然后模式3启动，它会找到{"采购方式及理由": "公开比选..."}，然后推断出需要查找"特殊情况处理"相关的内容，并找到正确的信息。
强化“完整遍历”规则：
规则2中明确严禁模型“偷懒”。这直接解决了它看到"采购方式及理由"的值后就停止搜索的问题。模型现在被强制要求，必须检查文档的每一个角落，才能下结论。
通过这套更严谨、更具层次感的指令，模型被“训练”成一个更有耐心、更有策略的分析师。它会首先尝试最直接的方法，如果行不通，它还准备了一套备用的、更智能的推断方案，从而确保能够找到深埋在复杂结构中的目标信息。

第四次优化
新需求，模型输出结果：
{"key": "Bid_Security_Amount", "value": "20000元"}
我需要的结果：
{"key": "Bid_Security_Amount", "value": "为保证公司合法权益，向应答人收取应答保证金20000元；通过ES系统管理保证金。"}


SHANGHAI_SYSTEM_PROMPT: |
  你是一个高度智能、逻辑严谨的结构化文档信息抽取AI助手。

  你的任务是根据一个“Key对应关系表”从“源数据文档”中提取信息。请严格按照以下三种优先级递减的模式进行操作：

  **模式1：直接映射 (Direct Mapping) - 优先级最高**
  -   **触发条件**: 关系表中的中文值为一个或多个用“或”连接的**实体名词**（如 "预算金额"）。
  -   **核心逻辑**: 在文档中寻找一个与所提供名词完全匹配的**键 (key)**。
  -   **执行流程**:
      a. 识别出所有备选名词（如 "公开招标"、"公开比选"）。
      b. **完整地、深度地**遍历整个“源数据文档”的所有层级，搜索是否存在一个**键**与备选名词列表中的任意一个完全匹配。
      c. 如果找到，立即提取其对应的完整value，并结束对此英语key的处理。

  **模式2：定向抽取 (Targeted Extraction) - 优先级中**
  -   **触发条件**: 关系表中的中文值为包含**“中抽取”等指令性描述**的句子。
  -   **核心逻辑**: 在一个已存在的**值 (value)** 中，抽取出一段**子文本 (sub-text)**。
  -   **执行流程**: (此部分逻辑不变)
      a. 解析指令，明确“源文本定位词”和“抽取目标词”。
      b. 使用“源文本定位词”作为key，执行一次**模式1**的查找，获取基础长文本。
      c. 在基础文本中，根据“抽取目标词”（可含“或”）进行搜索，提取最核心简洁的信息。

  **模式3：情境推断 (Contextual Inference) - 优先级最低**
  -   **触发条件**: 当且仅当**模式1**完全失败（即在整个文档中都找不到匹配的**键**）时，自动启用此模式。
  -   **核心逻辑**: 寻找一个**值 (value)**，其内容与查找目标高度相关，然后提取该值所在对象的**兄弟节点信息**。
  -   **执行流程**:
      a. **重新扫描**: 再次深度遍历整个文档，这次是寻找某个**值 (value)** 的内容**包含**备选名词（如 "公开比选"）。
      b. **定位关键节点**: 找到这个值后，定位到包含它的那个JSON对象（例如，`{"采购方式及理由": "公开比选。..."}`）。
      c. **推断并提取**: 分析这个关键节点所在的上下文。模型需要推断出，与这个采购方式（公开比选）相关的“特殊情况处理”很可能就在附近。因此，它应该查找与这个节点同级的、标题中含有“特殊情况”、“处理”等字样的**兄弟节点**或**父节点的其他子节点**，并提取其内容。例如，它会找到`{"公开比选": "当购买比选文件..."}`这个对象，并提取其value。

  **最终规则**:
  1.  **严格按优先级执行**: 对于每个key，必须先尝试模式1。只有当模式1确定性失败后，才能尝试模式3。模式2是独立触发的。
  2.  **完整遍历**: **严禁**在找到一个看似相关的线索后就停止对整个文档的遍历。必须完成对所有层级的搜索，才能判定模式1失败。
  3.  **精确简洁**: 在模式2和模式3中，返回的结果应尽可能核心、简洁。
  4.  **格式统一**: 最终返回一个JSON对象数组，格式与样例一致。
  5.  **最终缺失**: 只有当所有适用模式都尝试失败后，才将值设为 null。
  6.  **保持纯净**: 不要在JSON结果之外添加任何解释。



源数据文档:

  {
    "关于咸阳分公司2023-2024年度职工餐\n厅食材采购项目采购方案的汇报": [],
    "特定关系人与特定事项申报通知": [],
    "项目概况": [
        {
            "采购依据": "咸阳分公司2023-2024年度职工餐厅食材采购项目，经省公司2023年第43次总经理办公会会议审议，同意立项。根据咸阳分公司采购申请单，供应链管理部拟启动该项目的采购工作。"
        },
        {
            "资金来源": "本项目属于成本类开支。"
        },
        {
            "预算金额": "本项目预算金额355.16万元（不含税）。"
        },
        {
            "采购内容": "货物。 咸阳分公司2023-2024年度职工餐厅食材采购项目，主要包括主材类（大米、面粉、机制面条、糯米、食用油等）、副食类（肉、蛋、奶、冷冻鸡鸭鱼肉、鲜活畜禽等） 和其他类（蔬菜、水果、调味品、辅食类等）食材。合同期：12个月。"
        },
        {
            "采购信息表报送": "本项目不属于基础通信网络单元的重要网络产品和服务范围，不涉及关键基础信息表报送。"
        },
        {
            "网络安全审查": "根据公司网络安全审查机制要求，本项目不涉及网络安全审查预判工作。"
        }
    ],
    "采购方案": [
        {
            "采购方式及理由": "公开比选。本项目不属于法定招标范围，为加强竞争性，拟采用公开比选方式进行采购。"
        },
        {
            "资格审查方式": "本项目采用资格后审。"
        },
        {
            "组织形式": "本项目委托河北良诚招标代理有限公司代理组织采购。"
        },
        {
            "操作方式": "本项目采用无纸化电子采购。"
        },
        {
            "标段 /标包划分": "本项目不划分标包，划分为2个份额，具体如下："
        },
        {
            "最高限价": "本项目设置最高限价，应答综合折扣限价为100%。"
        },
        {
            "中选人确定原则": "按照综合得分由高至低的顺序排序，推荐综合得分排名前2名为中选候选人，确定综合得分排名前2名为中选人，中选份额依次为60%、40%。经评审的综合得分相等时，以评审价低者优先的原则推荐中选候选人；若评审价仍出现相等，以类似项目业绩累计金额高者优先的原则推荐中选候选人。"
        },
        {
            "合同签约模式": "本项目签订框架合同，合同金额按预算金额签订。"
        },
        {
            "业绩是否公示": "本项目公示业绩。"
        }
    ],
    "采购方案-潜在供应商资格条件": [
        {
            "应答人自2020年07月01日至应答截止之日止须至少具备一个单个合同金额不低于50万元的类似项目业绩。核算业绩数量以合同数量为准；应答人须提供合同关键页扫描件等证明材料，原件备查": "①合同关键页包括不限于合同封面、合同服务内容（合同标的）、合同金额、合同大签页等； ②业绩金额认定：合同以相对应的采购订单（或结算单）累计金额为准，若无订单（或结算单）则以合同对应的发票累计金额为准； ③凡提供合同及相对应的采购订单（或结算单）扫描件，须同时提供至少一张相对应的发票扫描件及发票真实有效的证明材料扫描件；凡提供合同及相对应的发票扫描件，须同时提供相对应的全部发票真实有效的证明材料扫描件。 ④发票真实有效的证明材料（国家税务总局全国增值税发票查验平台发票查询截图或发票开具单位当地税务机关出具的发票开具证明或其他可以证明发票真实有效的证明材料等）； ⑤订单（或结算单）须由甲方签字或盖章，否则视为无效订单（或结算单）； ⑥业绩日期认定：以合同签订日期为准。"
        },
        {
            "应答人不得存在以下情况": "1) 被责令停业的；2) 财产被接管或冻结，影响正常经营的；3) 在全国企业信用信息公示系统中被列入严重违法失信企业名单；4) 法定代表人或负责人 被“信用中国”网站列入失信被执行人名单（已执行完毕或不再执行的除外）；5) 在“信用中国”和工信部网站被相关行政监督部门暂停或取消应答/中选资格的（不受地域限制）；6) 在“信用中国”和工信部网站最近三年内（至本项目应答截止日期前36个月内）有被相关行政监督部门判定并发布弄虚作假骗取中标或严重违约或重大安全及事故责任、质量问题的。"
        },
        {
            "应答人之间存在下列互为关联关系的情形之一的，不得同时参加本项目的应答": "单位负责人为同一人或者存在控股、管理关系等可能影响公平性的不同单位，不得同时参加同一标包应答或者未划分标包的同一项目应答。"
        }
    ],
    "采购方案-合同主要条款": [],
    "采购方案-评审方法": [
        {
            "评审办法": "本项目采用综合评估法，价格60%，技术40%，价格技术各100分。综合评审得分=价格得分*60%+技术得分*40%，具体评审办法为：价格详见附录价格，技术详见附录技术。"
        }
    ],
    "采购方案-特殊情况处理": [
        {
            "公开比选": "当购买比选文件、递交应答文件或通过初步评审的供应商数量（S）<N+2（N为中选人数量，下同）时，则按照如下方式进行处理： 1、S=3，若评审委员会认定项目仍具备竞争性，继续实施后续比选过程； 2、S＜3，重新启动新的比选程序。 3、若重新启动后， 购买比选文件、递交应答文件或通过初步评审的供应商数量（S）仍<N+2， 若评审委员会认定项目仍具备竞争性，按下表方式处理："
        }
    ],
    "采购方案-其他": [
        {
            "评审委员会组成": "成员人数7人。从中国移动专家库内随机抽取5人，采购人代表2人。"
        },
        {
            "采购及履约过程风险控制": "1、应答保证金：为保证公司合法权益，向应答人收取应答保证金20000元；通过ES系统管理保证金。 2、履约保证金：人民币中选金额2%。"
        }
    ],
    "项目实施进度表 – 实施进度计划": [],
    "采购主要风险点评估（一）": [],
    "采购主要风险点评估（二）": [],
    "决策点": [],
    "附件-应答一览表": [],
    "附件-分项报价表": [],
    "附录-智慧平台核查结果": []
}



模型回答：
好的，我完全理解您的新需求。您遇到的问题和上次非常相似，但需求方向恰好相反。
上次的问题：模型返回了太多上下文（整个句子），而您想要更简洁的核心信息（金额）。
这次的问题：模型返回了太简洁的核心信息（金额），而您想要更多的上下文（整个句子）。
这再次证明了，最终规则 中那条一刀切的 3. **精确简洁** 规则是问题的根源。它要么过于严格，要么不符合特定情况下的需求。
解决方案是彻底删除这条“简洁”规则，并重新定义模式2的提取目标，让它默认提取更完整的上下文信息。
优化后的 SHANGHAI_SYSTEM_PROMPT
这个版本直接修改了模式2的核心逻辑和最终规则，以满足您获取完整上下文的需求。
code
Yaml
SHANGHAI_SYSTEM_PROMPT: |
  你是一个高度智能、逻辑严谨的结构化文档信息抽取AI助手。

  你的任务是根据一个“Key对应关系表”从“源数据文档”中提取信息。请严格按照以下三种优先级递减的模式进行操作：

  **模式1：直接映射 (Direct Mapping) - 优先级最高**
  -   (此模式逻辑保持不变)
  -   **触发条件**: 关系表中的中文值为一个或多个用“或”连接的**实体名词**（如 "预算金额"）。
  -   **核心逻辑**: 在文档中寻找一个与所提供名词完全匹配的**键 (key)**。
  -   **执行流程**: 完整地、深度地遍历文档，搜索匹配的键，并提取其对应的完整value。

  **模式2：上下文定向抽取 (Contextual Targeted Extraction) - 优先级中**
  -   **触发条件**: 关系表中的中文值为包含**“中抽取”等指令性描述**的句子。
  -   **核心逻辑**: 在一个已存在的**值 (value)** 中，抽取出包含目标信息的**完整句子或上下文单元**。
  -   **执行流程**:
      a. 解析指令，明确“源文本定位词”和“抽取目标词”。
      b. 使用“源文本定位词”作为key，执行一次**模式1**的查找，获取基础长文本。
      c. 在基础文本中，根据“抽取目标词”（可含“或”）进行搜索，并提取包含该目标的**完整、独立的句子或条款**。例如，如果目标是“应答保证金”，则应返回包含它的整个条款，如“1、应答保证金：为保证公司合法权益，向应答人收取应答保证金20000元；通过ES系统管理保证金。”。

  **模式3：情境推断 (Contextual Inference) - 优先级最低**
  -   (此模式逻辑保持不变)
  -   **触发条件**: 当且仅当**模式1**完全失败时启用。
  -   **核心逻辑**: 寻找一个值(value)其内容与查找目标高度相关，然后提取该值所在对象的兄弟节点信息。
  -   **执行流程**: 扫描文档值，定位关键节点，分析上下文并提取相关兄弟节点或父节点的其他子节点的内容。

  **最终规则**:
  1.  **严格按优先级执行**: 模式1 -> 模式3。模式2独立触发。
  2.  **完整遍历**: **严禁**在找到看似相关的线索后就停止对整个文档的遍历。
  3.  **提取粒度 (Extraction Granularity)**:
      - 对于**模式1**和**模式3**，直接返回找到的完整value。
      - 对于**模式2**，必须返回包含抽取目标的**完整句子或条款**，而不是仅仅返回数值或关键词本身。
  4.  **格式统一**: 最终返回一个JSON对象数组，格式与样例一致。
  5.  **最终缺失**: 只有当所有适用模式都尝试失败后，才将值设为 null。
  6.  **保持纯净**: 不要在JSON结果之外添加任何解释。
为什么这次的修改能解决问题？
重新命名并定义模式2：
我将定向抽取改为了上下文定向抽取 (Contextual Targeted Extraction)。这个名字本身就在暗示模型，提取的目标是“上下文”，而不仅仅是“点”。
在执行流程c中，我给出了一个非常具体的例子，直接指导模型：“如果目标是‘应答保证金’，你应该返回像‘1、应答保证金：...’这样的完整句子。”，这是一种非常有效的指令方式（In-context learning）。
彻底修改了关键规则：
我将原来有问题的3. **精确简洁**规则，替换为了一个新的、更明确的规则3. **提取粒度 (Extraction Granularity)**。
这个新规则清晰地规定了不同模式下的提取详细程度。
最重要的是，它明确指示对于模式2，必须 (must) 返回完整句子或条款，并用反例强调了不能 (not just) 只返回数值或关键词。这种“Do this, not that”的指令对模型有极强的约束力。
模型现在会如何处理 Bid_Security_Amount？
触发模式2：关系表的值是"采购及履约过程风险控制中抽取应答保证金或投标保证金"。
定位源文本：模型找到"采购及履约过程风险控制"的value："1、应答保证金：... 2、履约保证金：..."。
执行抽取：
模型在源文本中搜索"应答保证金"。
根据模式2和规则3的新指令，它知道不能只拿出"20000元"，而必须提取包含"应答保证金"的那个完整条款。
因此，它会正确地提取出："1、应答保证金：为保证公司合法权益，向应答人收取应答保证金20000元；通过ES系统管理保证金。"
通过这次修改，您等于告诉模型：“在进行抽取任务时，我更看重信息的完整性和上下文，请不要过度简化你的答案。” 这将完美地满足您的新需求。